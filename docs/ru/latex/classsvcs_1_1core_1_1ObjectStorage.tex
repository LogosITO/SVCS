\doxysection{Класс svcs\+::core\+::Object\+Storage}
\hypertarget{classsvcs_1_1core_1_1ObjectStorage}{}\label{classsvcs_1_1core_1_1ObjectStorage}\index{svcs::core::ObjectStorage@{svcs::core::ObjectStorage}}


Управляет базой данных объектов системы контроля версий, включая сохранение и восстановление объектов.  




{\ttfamily \#include $<$Object\+Storage.\+hxx$>$}

Граф наследования\+:svcs\+::core\+::Object\+Storage\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classsvcs_1_1core_1_1ObjectStorage}
\end{center}
\end{figure}
\doxysubsubsection*{Открытые члены}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsvcs_1_1core_1_1ObjectStorage_a080fa691f97a255abe1d65962c16b0e0}{Object\+Storage}} (const std\+::string \&root\+\_\+path, const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classsvcs_1_1services_1_1ISubject}{ISubject}} $>$ \&subject=nullptr)
\begin{DoxyCompactList}\small\item\em Конструктор для \doxylink{classsvcs_1_1core_1_1ObjectStorage}{Object\+Storage}. \end{DoxyCompactList}\item 
\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_ab6ceb81115dacf56d6a99f5721e30c78}\label{classsvcs_1_1core_1_1ObjectStorage_ab6ceb81115dacf56d6a99f5721e30c78} 
virtual {\bfseries \texorpdfstring{$\sim$}{\string~}\+Object\+Storage} ()
\begin{DoxyCompactList}\small\item\em Деструктор. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classsvcs_1_1core_1_1ObjectStorage_a1af2a8c7d75e55827cd1c88a3370beec}{set\+Subject}} (std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classsvcs_1_1services_1_1ISubject}{ISubject}} $>$ subj)
\begin{DoxyCompactList}\small\item\em Устанавливает или заменяет субъект событий, используемый \doxylink{classsvcs_1_1core_1_1ObjectStorage}{Object\+Storage}. \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{classsvcs_1_1core_1_1ObjectStorage_acf98d1402cbc3bb112bca7a19a3400f3}{get\+Object\+Path}} (const std\+::string \&hash) const
\begin{DoxyCompactList}\small\item\em Формирует полный путь в файловой системе для объекта на основе его хеша. \end{DoxyCompactList}\item 
virtual bool \mbox{\hyperlink{classsvcs_1_1core_1_1ObjectStorage_afcd2404560b69f9aa502d7ddc67de225}{save\+Object}} (const \mbox{\hyperlink{classsvcs_1_1core_1_1VcsObject}{Vcs\+Object}} \&obj) const
\begin{DoxyCompactList}\small\item\em Сохраняет \doxylink{classsvcs_1_1core_1_1VcsObject}{Vcs\+Object} в базе данных объектов. \end{DoxyCompactList}\item 
virtual std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsvcs_1_1core_1_1VcsObject}{Vcs\+Object}} $>$ \mbox{\hyperlink{classsvcs_1_1core_1_1ObjectStorage_a6f5c0cacdeb8b319358ef9e3cce2bd9f}{load\+Object}} (const std\+::string \&hash) const
\begin{DoxyCompactList}\small\item\em Загружает объект с диска по его ID хеша. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classsvcs_1_1core_1_1ObjectStorage_aceaa59aa102d6f79aae8ed17765b4f6e}{object\+Exists}} (const std\+::string \&hash) const
\begin{DoxyCompactList}\small\item\em Проверяет, существует ли объект с заданным хешем на диске. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Подробное описание}
Управляет базой данных объектов системы контроля версий, включая сохранение и восстановление объектов. 

Реализует низкоуровневые операции файловой системы (генерация путей, чтение, запись), сжатие, распаковку и десериализацию объектов. 

\label{doc-constructors}
\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_doc-constructors}
\doxysubsection{Конструктор(ы)}
\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_a080fa691f97a255abe1d65962c16b0e0}\index{svcs::core::ObjectStorage@{svcs::core::ObjectStorage}!ObjectStorage@{ObjectStorage}}
\index{ObjectStorage@{ObjectStorage}!svcs::core::ObjectStorage@{svcs::core::ObjectStorage}}
\doxysubsubsection{\texorpdfstring{ObjectStorage()}{ObjectStorage()}}
{\footnotesize\ttfamily \label{classsvcs_1_1core_1_1ObjectStorage_a080fa691f97a255abe1d65962c16b0e0} 
svcs\+::core\+::\+Object\+Storage\+::\+Object\+Storage (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{root\+\_\+path}{, }\item[{const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classsvcs_1_1services_1_1ISubject}{ISubject}} $>$ \&}]{subject}{ = {\ttfamily nullptr}}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}



Конструктор для \doxylink{classsvcs_1_1core_1_1ObjectStorage}{Object\+Storage}. 


\begin{DoxyParams}{Аргументы}
{\em root\+\_\+path} & Корневой путь репозитория (например, директория, содержащая "{}.\+svcs"{}). \\
\hline
{\em subject} & Общий указатель на интерфейс \doxylink{classsvcs_1_1services_1_1ISubject}{ISubject} для логирования событий. По умолчанию nullptr, если логирование пока не требуется. \\
\hline
\end{DoxyParams}


\label{doc-func-members}
\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_doc-func-members}
\doxysubsection{Методы}
\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_acf98d1402cbc3bb112bca7a19a3400f3}\index{svcs::core::ObjectStorage@{svcs::core::ObjectStorage}!getObjectPath@{getObjectPath}}
\index{getObjectPath@{getObjectPath}!svcs::core::ObjectStorage@{svcs::core::ObjectStorage}}
\doxysubsubsection{\texorpdfstring{getObjectPath()}{getObjectPath()}}
{\footnotesize\ttfamily \label{classsvcs_1_1core_1_1ObjectStorage_acf98d1402cbc3bb112bca7a19a3400f3} 
std\+::string svcs\+::core\+::\+Object\+Storage\+::get\+Object\+Path (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{hash}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [nodiscard]}}



Формирует полный путь в файловой системе для объекта на основе его хеша. 

Использует первые два символа хеша для имени поддиректории и оставшиеся 38 символов для имени файла. 
\begin{DoxyParams}{Аргументы}
{\em hash} & Полный 40-\/символьный ID хеша SHA-\/1. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Возвращает}
std\+::string Полный, независимый от платформы путь к файлу. 
\end{DoxyReturn}
\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_a6f5c0cacdeb8b319358ef9e3cce2bd9f}\index{svcs::core::ObjectStorage@{svcs::core::ObjectStorage}!loadObject@{loadObject}}
\index{loadObject@{loadObject}!svcs::core::ObjectStorage@{svcs::core::ObjectStorage}}
\doxysubsubsection{\texorpdfstring{loadObject()}{loadObject()}}
{\footnotesize\ttfamily \label{classsvcs_1_1core_1_1ObjectStorage_a6f5c0cacdeb8b319358ef9e3cce2bd9f} 
std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsvcs_1_1core_1_1VcsObject}{Vcs\+Object}} $>$ svcs\+::core\+::\+Object\+Storage\+::load\+Object (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{hash}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [nodiscard]}, {\ttfamily [virtual]}}



Загружает объект с диска по его ID хеша. 

Читает сжатый файл, распаковывает его, выполняет проверки целостности и десериализует объект с использованием внутреннего фабричного метода. 
\begin{DoxyParams}{Аргументы}
{\em hash} & ID хеша объекта для загрузки. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Возвращает}
std\+::unique\+\_\+ptr$<$\+Vcs\+Object$>$ Восстановленный экземпляр объекта. 
\end{DoxyReturn}

\begin{DoxyExceptions}{Исключения}
{\em std\+::runtime\+\_\+error} & если объект не найден, поврежден или недействителен. \\
\hline
\end{DoxyExceptions}


Переопределяется в \mbox{\hyperlink{classsvcs_1_1test_1_1core_1_1MockObjectStorage_a1cc049df93020cc42fdbaa81ad799b40}{svcs\+::test\+::core\+::\+Mock\+Object\+Storage}}.

\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_aceaa59aa102d6f79aae8ed17765b4f6e}\index{svcs::core::ObjectStorage@{svcs::core::ObjectStorage}!objectExists@{objectExists}}
\index{objectExists@{objectExists}!svcs::core::ObjectStorage@{svcs::core::ObjectStorage}}
\doxysubsubsection{\texorpdfstring{objectExists()}{objectExists()}}
{\footnotesize\ttfamily \label{classsvcs_1_1core_1_1ObjectStorage_aceaa59aa102d6f79aae8ed17765b4f6e} 
bool svcs\+::core\+::\+Object\+Storage\+::object\+Exists (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{hash}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [nodiscard]}}



Проверяет, существует ли объект с заданным хешем на диске. 


\begin{DoxyParams}{Аргументы}
{\em hash} & ID хеша для проверки. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Возвращает}
bool True, если файл объекта существует. 
\end{DoxyReturn}
\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_afcd2404560b69f9aa502d7ddc67de225}\index{svcs::core::ObjectStorage@{svcs::core::ObjectStorage}!saveObject@{saveObject}}
\index{saveObject@{saveObject}!svcs::core::ObjectStorage@{svcs::core::ObjectStorage}}
\doxysubsubsection{\texorpdfstring{saveObject()}{saveObject()}}
{\footnotesize\ttfamily \label{classsvcs_1_1core_1_1ObjectStorage_afcd2404560b69f9aa502d7ddc67de225} 
bool svcs\+::core\+::\+Object\+Storage\+::save\+Object (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classsvcs_1_1core_1_1VcsObject}{Vcs\+Object}} \&}]{obj}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [nodiscard]}, {\ttfamily [virtual]}}



Сохраняет \doxylink{classsvcs_1_1core_1_1VcsObject}{Vcs\+Object} в базе данных объектов. 

Сериализует объект, добавляет заголовок, сжимает его и записывает в файл. Публикует события об успехе/неудаче. 
\begin{DoxyParams}{Аргументы}
{\em obj} & \doxylink{classsvcs_1_1core_1_1VcsObject}{Vcs\+Object} для сохранения. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Возвращает}
bool True, если сохранение прошло успешно. 
\end{DoxyReturn}

\begin{DoxyExceptions}{Исключения}
{\em std\+::runtime\+\_\+error} & если хеш недействителен или операции ввода-\/вывода завершаются неудачно. \\
\hline
\end{DoxyExceptions}


Переопределяется в \mbox{\hyperlink{classsvcs_1_1test_1_1core_1_1MockObjectStorage_a3bfbf6c9ca8c6298b49cb5ba4a6c20f8}{svcs\+::test\+::core\+::\+Mock\+Object\+Storage}}.

\Hypertarget{classsvcs_1_1core_1_1ObjectStorage_a1af2a8c7d75e55827cd1c88a3370beec}\index{svcs::core::ObjectStorage@{svcs::core::ObjectStorage}!setSubject@{setSubject}}
\index{setSubject@{setSubject}!svcs::core::ObjectStorage@{svcs::core::ObjectStorage}}
\doxysubsubsection{\texorpdfstring{setSubject()}{setSubject()}}
{\footnotesize\ttfamily \label{classsvcs_1_1core_1_1ObjectStorage_a1af2a8c7d75e55827cd1c88a3370beec} 
void svcs\+::core\+::\+Object\+Storage\+::set\+Subject (\begin{DoxyParamCaption}\item[{std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classsvcs_1_1services_1_1ISubject}{ISubject}} $>$}]{subj}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Устанавливает или заменяет субъект событий, используемый \doxylink{classsvcs_1_1core_1_1ObjectStorage}{Object\+Storage}. 


\begin{DoxyParams}{Аргументы}
{\em subj} & Новый указатель \doxylink{classsvcs_1_1services_1_1ISubject}{ISubject} для использования при публикации событий. \\
\hline
\end{DoxyParams}


Объявления и описания членов классов находятся в файлах\+:\begin{DoxyCompactItemize}
\item 
core/include/\mbox{\hyperlink{ObjectStorage_8hxx}{Object\+Storage.\+hxx}}\item 
core/src/\mbox{\hyperlink{ObjectStorage_8cxx}{Object\+Storage.\+cxx}}\end{DoxyCompactItemize}
